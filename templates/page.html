<!DOCTYPE html>
<html lang="pt-BR">
<head>
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lilo.st</title>
    <link rel="stylesheet" type="text/css" href="/static/post.css">

	<script>
		async function tentarPostar() {
			const conteudo = document.getElementById('content').value;
			console.log(conteudo);
			const response = await fetch('/api/publicar', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json'
				},
				body: JSON.stringify({conteudo})
			});
			const result = await response.json();
			const messageDiv = document.getElementById('message');
			if (result.success) {
				messageDiv.textContent = 'Postado com sucesso!';
				document.getElementById('content').value = '';
				messageDiv.style.color = 'green';
				carregarPublicacoes();
			} else {
				messageDiv.textContent = `Erro: ${result.error}`;
				messageDiv.style.color = 'red';
			}
		}
	</script>
</head>
<body>
	<div class="content-container">
		<div class="message" id="message"></div>
			<label for="content">Conte√∫do</label>
			<textarea id="content" name="conteudo" required></textarea>
			<button id="button-post" onclick="tentarPostar()">POSTAR</button>
		
		<br>
		<button id="logoutButton">Desconectar</button>
	</div>
	<div class="post-container">

    </div> 

	<script>
		document.getElementById("logoutButton").addEventListener("click", function() {
			window.location.href = "/deslogar";
		});
		async function carregarPublicacoes() {
			const response = await fetch('/api/publicacoes');
			const result = await response.json();
			const container = document.querySelector('.post-container');
			container.innerHTML = '';
			result.forEach(publicacao => {
				const div = document.createElement('div');
				div.className = 'post';
				div.textContent = `${publicacao.user}: ${publicacao.conteudo}`;
				container.appendChild(div);
				botao = document.createElement('button-deletar');
				botao.innerHTML = '<img src="/static/deletar.jpg" alt="Deletar" width="25" height="25">';
				

				botao.addEventListener('click', async function() {
					const response = await fetch('/api/deletar', {
						method: 'POST',
						headers: {
							'Content-Type': 'application/json'
						},
						body: JSON.stringify({id: publicacao.id, user: publicacao.user})
					});
					const result = await response.json();
					if (result.success) {
						carregarPublicacoes();
					} else {
						const messageDiv = document.getElementById('message');
						messageDiv.textContent = `Erro: ${result.error}`;
						messageDiv.style.color = 'red';
					}
				});
				div.appendChild(botao);
			});
		}

		carregarPublicacoes();
    
	</script>
</body>
</html>
